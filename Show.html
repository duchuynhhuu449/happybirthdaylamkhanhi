<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🎂 Chúc mừng sinh nhật – Nguyễn Thị Bích Yên</title>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">

<style>
    * { box-sizing: border-box; margin:0; padding:0; }
    html, body { height:100%; font-family:'Dancing Script', cursive,'Courier New', monospace; overflow:hidden; position:relative; }

    body::before {
        content:'';
        position:fixed; inset:0;
        background:url('./assets/img/BirthdayCommingSoon.png') center/cover no-repeat;
        filter:blur(6px); z-index:-1;
    }

    /* Start Screen */
    #startScreen {
        position:fixed; inset:0;
        display:flex; flex-direction:column; align-items:center; justify-content:center;
        background:rgba(0,0,0,0.85); color:#fff; z-index:250;
    }
    #startScreen h1 { font-size:28px; margin-bottom:20px; text-align:center; }
    #startScreen button {
        font-size:20px; padding:12px 24px; border:none; border-radius:12px;
        background:linear-gradient(90deg,#ff9bce,#ffd166); color:#000; cursor:pointer;
    }

    /* Rotate notice */
    .rotateNotice {
        position:fixed; inset:0; display:none !important; z-index:200;
        background:rgba(0,0,0,0.95); color:#fff;
        display:flex; align-items:center; justify-content:center; text-align:center; padding:20px;
    }
    .rotateNotice.show { display:flex; }
    .rotateNotice h2 { font-size:22px; margin-bottom:8px; }
    .rotateNotice p { opacity:0.9; }

    /* Overlay */
    .overlay {
        position:fixed; inset:0;
        background:rgba(0,0,0,0.45);
        z-index:2; transition:opacity 900ms ease;
    }

    /* Stage & Card */
    .stage { position:fixed; inset:0; display:grid; place-items:center; padding:24px; z-index:10; }
    .card {
        max-width:1000px; width:90%; height:400px;
        background:rgba(0,0,0,0.55); border-radius:20px;
        padding:36px; text-align:left; position:relative;
        box-shadow:0 12px 50px rgba(0,0,0,0.6); z-index:20;
    }

    .headline {
        font-size:36px; text-align:center; margin-bottom:18px;
        background:linear-gradient(90deg,#ffd166,#ff9bce);
        -webkit-background-clip:text; background-clip:text; color:transparent;
        text-shadow:0 6px 18px rgba(0,0,0,0.45);
        display:flex; align-items:center; justify-content:center; gap:10px;
    }
    .headline .icon { font-size:34px; transform:translateY(2px); }

    .content { font-size:28px; line-height:1.45; min-height:12em; color:#fff; display:block; align-items:center; justify-content:center; text-align:center; }
    .typewriter { white-space:pre-wrap; max-width:92%; margin:0 auto; display:block;text-align: center; }
    .typewriter::after { content:'|'; display:inline-block; margin-left:0.04em; opacity:1; animation:blink 1s steps(1,end) infinite; vertical-align:bottom; font-weight:700; }
    @keyframes blink { 50% { opacity:0; } }

    .bottomBar { position:absolute; left:20px; right:20px; bottom:16px; display:flex; align-items:center; gap:12px; z-index:30; }
    .progress { flex:1; height:8px; background:rgba(255,255,255,0.08); border-radius:8px; overflow:hidden; position:relative; }
    .progressInner { width:0%; height:100%; background:linear-gradient(90deg,#ff9bce,#ffd166); transition:width linear; }
    .progText { min-width:48px; text-align:center; font-size:14px; background:rgba(255,255,255,0.06); padding:6px 10px; border-radius:999px; }

    /* Balloons */
    .balloons { position:fixed; inset:0; pointer-events:none; z-index:5; }
    .balloon { position:absolute; bottom:-120px; border-radius:50%; opacity:0.9; transform-origin:center bottom; filter:blur(.2px); }
    @keyframes floatUp { 0% { transform:translateY(0) translateX(0) rotate(0deg); opacity:1; } 100% { transform:translateY(-140vh) translateX(20px) rotate(360deg); opacity:.06; } }

    /* Celebrate final */
    .celebrate { position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,0.92); color:#fff; z-index:60; opacity:0; pointer-events:none; transition:opacity 900ms ease; }
    .celebrate.show { opacity:1; pointer-events:auto; }
    .finalWrap { text-align:center; position:relative; }
    .orbit { position:relative; width:520px; height:520px; margin:20px auto 0; }
    .orbit .cake { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:260px; height:260px; background:url('./assets/img/HappyBirthDay.png') center/contain no-repeat; z-index:30; }
    .orbit img { position:absolute; width:110px; height:110px; border-radius:12px; object-fit:cover; border:4px solid rgba(255,255,255,0.12); box-shadow:0 8px 30px rgba(0,0,0,0.6); transform-origin:center; }
    .finalText { margin-top:18px; font-size:22px; }

    /* fade */
    .fadeIn { animation:fadeIn 420ms ease both; }
    .fadeOut { animation:fadeOut 320ms ease both; }
    @keyframes fadeIn { from {opacity:0; transform:translateY(6px);} to {opacity:1; transform:none;} }
    @keyframes fadeOut { from {opacity:1;} to {opacity:0; transform:translateY(-6px);} }

    @media (max-width:820px) {
        .content { font-size:22px; }
        .orbit { width:360px; height:360px; }
        .orbit img { width:80px; height:80px; }
        .headline { font-size:28px; }
    }
</style>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>

<body>
    <div id="startScreen">
        <h1>🎉 Chào mừng đến với trình chiếu của buổi sinh nhật ngày hôm nay. 🎉</h1>
        <button id="startBtn">Bắt đầu trình chiếu</button>
    </div>

    <div class="rotateNotice" id="rotateNotice">
        <div>
            <h2>Xoay ngang màn hình để xem trình chiếu</h2>
            <p>Trình chiếu đẹp hơn khi xoay ngang (landscape). Vui lòng xoay điện thoại để tiếp tục.</p>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="balloons" id="balloons"></div>

    <audio id="bgm" preload="auto" loop></audio>

    <div class="stage">
        <div class="card" id="card">
            <div class="headline"><span class="icon">🎉</span><span>Chúc mừng sinh nhật Nguyễn Thị Bích Yên</span></div>
            <div class="content"><span class="typewriter" id="tw"></span></div>
            <div class="bottomBar">
                <div class="progress" id="progressBar"><div class="progressInner" id="progressInner"></div></div>
                <div class="progText" id="progText"></div>
            </div>
        </div>
    </div>

    <div class="celebrate" id="celebrate">
        <div class="finalWrap">
            <div class="orbit" id="orbit">
                <div class="cake"></div>
            </div>
            <div class="finalText" id="finalText">Cùng nhau lưu giữ khoảnh khắc đặc biệt tại đây nhé</div>
        </div>
    </div>

<script>
const DEFAULT_MUSIC = './assets/song.mp3';
const startScreen = document.getElementById('startScreen');
const startBtn = document.getElementById('startBtn');
const twEl = document.getElementById('tw');
const progressInner = document.getElementById('progressInner');
const progText = document.getElementById('progText');
const celebrate = document.getElementById('celebrate');
const balloonsWrap = document.getElementById('balloons');
const bgm = document.getElementById('bgm');
const overlay = document.getElementById('overlay');
const rotateNotice = document.getElementById('rotateNotice');

let started = false;
let orientationChecked = false; // fix: khai báo cờ này
bgm.src = DEFAULT_MUSIC; bgm.volume=0.8;

const script = [
    { text:"Khoảnh khắc mà tui chờ từ lâu cuối cùng cũng tới. Hôm nay là ngày của bà — và tui muốn dành cả tấm lòng này để nói những điều thật giản dị nhưng chân thành.", hold:6000 },
    { text:"Nguyễn Thị Bích Yên", hold:3000 },
    { text:"08/09/2004", hold:3000 },
    { text:"Hôm nay bà 22 tuổi. Tuổi của những khởi đầu, của những dự định còn dang dở và những ước mơ còn chưa kịp nói.", hold:5500 },
    { text:"Chúc bà một ngày thật trọn vẹn. Tui mong bà luôn thấy ấm áp, luôn có tiếng cười và luôn cảm thấy an toàn bên những người yêu thương.", hold:7000 },
    { text:"Hãy cứ dũng cảm theo đuổi những điều bà muốn. Tui tin bà làm được — và tui ở đây, âm thầm cổ vũ, nắm chặt niềm tin ấy cùng bà.", hold:6500 },
    { text:"Có một điều tui giữ trong lòng lâu rồi. Tui thích cách bà cười, thích cách bà dịu dàng với mọi người, và tự nhiên tui muốn được gần bà hơn nữa.", hold:9000 },
    { text:"Nếu bà cho phép, tui muốn được nắm tay bà trong những ngày bình thường lẫn những ngày đặc biệt. Không vội, chỉ chân thành và kiên nhẫn.", hold:8000 },
    { text:"Mong tuổi mới sẽ mở ra những niềm vui không ngờ, những kỷ niệm ngọt ngào và những người bạn thật lòng đồng hành cùng bà.", hold:5500 },
    { text:"Một lần nữa, chúc mừng sinh nhật bà. Hãy để hôm nay là khởi đầu cho mọi điều tốt đẹp và cho những yêu thương sẽ đến.", hold:6500 }
];

function isLandscape(){ return window.innerWidth > window.innerHeight; }
function checkOrientationAndStart(){
    // chỉ hiện overlay nếu chưa bấm start và chưa kiểm tra orientation
    if(!started && !isLandscape() && /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent) && !orientationChecked){
        rotateNotice.classList.add('show');
        overlay.style.opacity='1';
        return false;
    } else {
       
        rotateNotice.classList.remove('show');
    
        overlay.style.opacity='0.45';
        orientationChecked = true; // đã kiểm tra xong, không hiện lại
        if(!started){
            started = true;
            runScript();
            bgm.play().catch(()=>{});
        }
        return true;
    }
}

window.addEventListener('resize', checkOrientationAndStart);
window.addEventListener('orientationchange', ()=>setTimeout(checkOrientationAndStart, 400));

function createBalloons(){
    const count=18;
    for(let i=0;i<count;i++){
        const b=document.createElement('div'); b.className='balloon';
        const size=24+Math.random()*40; b.style.width=b.style.height=size+'px';
        const side=Math.random()<0.5?'left':'right';
        b.style.left=(side==='left'?4+Math.random()*18:78+Math.random()*17)+'%';
        b.style.background='radial-gradient(circle at 35% 30%, rgba(255,255,255,0.95), rgba(255,182,193,0.85))';
        const dur=10+Math.random()*12;
        b.style.animation=`floatUp ${dur}s linear ${Math.random()*3}s infinite`;
        b.style.opacity=0.9-Math.random()*0.45;
        balloonsWrap.appendChild(b);
    }
}
createBalloons();

function fadeInEl(el){ el.classList.remove('fadeOut'); el.classList.add('fadeIn'); }
function fadeOutEl(el){ el.classList.remove('fadeIn'); el.classList.add('fadeOut'); }

function isShortText(s){ return s.replace(/\s+/g,' ').trim().length<40; }

function typeText(text, perChar=40){ return new Promise(resolve=>{
    const card=document.getElementById('card');
    if(isShortText(text)){ card.querySelector('.content').style.textAlign='center'; } else { card.querySelector('.content').style.textAlign='left'; }
    twEl.textContent=''; fadeInEl(twEl);
    let i=0; const chars=[...text];
    const timer=setInterval(()=>{ twEl.textContent+=chars[i++]||''; if(i>=chars.length){ clearInterval(timer); resolve(); } }, perChar);
});}

function deleteText(perChar=28){ return new Promise(resolve=>{
    const timer=setInterval(()=>{
        const txt=twEl.textContent;
        if(!txt || txt.length===0){ clearInterval(timer); resolve(); return; }
        twEl.textContent=txt.slice(0,-1);
    }, perChar);
});}

function holdWithCountdown(ms){ return new Promise(resolve=>{
    const total=Math.max(0,ms); let remaining=Math.ceil(total/1000);
    progText.textContent=remaining+'s';
    progressInner.style.transition=`width ${total}ms linear`; progressInner.style.width='0%';
    void progressInner.offsetWidth; progressInner.style.width='100%';
    const interval=setInterval(()=>{ remaining--; progText.textContent=(remaining>0?remaining+'s':'0s'); },1000);
    setTimeout(()=>{ clearInterval(interval); progressInner.style.transition='none'; progressInner.style.width='0%'; progText.textContent=''; resolve(); }, total);
});}

async function runScript(){
    for(let i=0;i<script.length;i++){
        const seg=script[i];
        if(twEl.textContent){ fadeOutEl(twEl); await new Promise(r=>setTimeout(r,280)); twEl.textContent=''; }
        await typeText(seg.text,40); await holdWithCountdown(seg.hold); await deleteText(28); await new Promise(r=>setTimeout(r,240));
    }
    twEl.style.opacity='0'; overlay.style.opacity='1'; await new Promise(r=>setTimeout(r,700));
    showFinal();
}

function showFinal(){
    celebrate.classList.add('show');
    const orbit=document.getElementById('orbit'); orbit.innerHTML='<div class="cake"></div>';
    const n=6; const radius=Math.min(200, orbit.clientWidth*0.38);
    for(let i=0;i<n;i++){
        const img=document.createElement('img'); img.src=`https://via.placeholder.com/200x200?text=Ảnh+${i+1}`; img.style.opacity='0';
        orbit.appendChild(img);
        const angle=(i/n)*Math.PI*2 - Math.PI/2;
        const cx=orbit.clientWidth/2; const cy=orbit.clientHeight/2;
        const x=cx+Math.cos(angle)*radius-(img.width/2||55);
        const y=cy+Math.sin(angle)*radius-(img.height/2||55);
        img.style.left=x+'px'; img.style.top=y+'px';
        img.style.transition=`transform 700ms ease ${i*90}ms, opacity 700ms ease ${i*90}ms`;
        setTimeout(()=>{ img.style.opacity='1'; img.style.transform='translateY(-8px)'; }, 200+i*90);
    }
    launchConfetti();
}

function launchConfetti(){
    const wrap=document.createElement('div'); wrap.style.position='fixed'; wrap.style.left='0'; wrap.style.top='0'; wrap.style.width='100%'; wrap.style.height='100%'; wrap.style.pointerEvents='none'; wrap.style.zIndex=120;
    document.body.appendChild(wrap);
    const colors=['#ff8fc3','#ffd166','#7ef0c7','#ffd5f0','#b3e5ff']; const pieces=40;
    for(let i=0;i<pieces;i++){
        const d=document.createElement('div'); const size=6+Math.random()*12; d.style.width=d.style.height=size+'px';
        d.style.background=colors[Math.floor(Math.random()*colors.length)];
        d.style.position='absolute'; d.style.left=(30+Math.random()*40)+'%'; d.style.top=(40+Math.random()*20)+'%'; d.style.opacity='1';
        d.style.borderRadius=(Math.random()>0.6?'0':'50%'); d.style.transform=`translateY(0) rotate(${Math.random()*360}deg)`;
        d.style.transition=`transform ${1200+Math.random()*900}ms cubic-bezier(.2,.8,.2,1), opacity 1200ms linear`;
        wrap.appendChild(d); setTimeout(()=>{ d.style.transform=`translate(${(-120+Math.random()*240)}px, ${-700-Math.random()*200}px) rotate(${Math.random()*720}deg)`; d.style.opacity='0'; }, 80+i*20);
    }
    setTimeout(()=>wrap.remove(),2600);
}

function hideSafariAddressBar(){ setTimeout(()=>window.scrollTo(0,1),100); document.documentElement.style.height='100%'; document.body.style.height='100%'; document.body.style.margin='0'; document.body.style.padding='0'; }

window.addEventListener('load',()=>{
    bgm.play().catch(()=>{});
    hideSafariAddressBar();
});

startBtn.addEventListener('click',()=>{
    startScreen.style.display='none';
    bgm.play().catch(()=>console.log("BGM blocked"));
    checkOrientationAndStart(); // bấm start = chạy script + ẩn overlay
});

// Update orbit photos externally
window.updatePhotos=function(urls){
    const orbit=document.getElementById('orbit');
    const imgs=orbit.querySelectorAll('img');
    for(let i=0;i<imgs.length && i<urls.length;i++){ imgs[i].src=urls[i]||imgs[i].src; }
};
</script>
</body>
</html>
